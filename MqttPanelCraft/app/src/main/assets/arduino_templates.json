{
   "base": {
      "header": "/**\n * Generated by MqttPanelCraft\n */\n\n#include <Arduino.h>\n#include \"mqttpanel.h\"\n\n// --- Platform Specifics ---\n#if defined(ESP32)\n  #include <WiFi.h>\n#elif defined(ESP8266)\n  #include <ESP8266WiFi.h>\n#endif\n\n// --- User Config ---\n// If LittleFS has saved config, these defaults might be overwritten.\nchar mqtt_server[40] = \"{{BROKER}}\";\nchar mqtt_port[6]    = \"{{PORT}}\";\nchar mqtt_topic_head[40]  = \"{{BASE_TOPIC}}/\"; // Ensure trailing slash\n\n// Button Settings (Sec)\n#define BTN_PORTAL_SEC 3\n#define BTN_RESET_SEC  10\n#define CHECK_WIFI_SEC 20\n\n// Hardware Pins\n#define TRIGGER_PIN 0  // Boot Button\n#define LED_PIN     4  // Status LED\n\n// --- Objects ---\nWiFiClient espClient;\nPubSubClient client(espClient);\n\n// --- Component Globals ---\n",
      "setup_start": "void mq_receiver(String topic, String msg);\n\nvoid setup() {\n  // 1. Hardware Init\n  Serial.begin(115200);\n  Serial.println(\"\\n[System] Booting...\");\n  pinMode(TRIGGER_PIN, INPUT_PULLUP);\n  pinMode(LED_PIN, OUTPUT);\n\n  // 2. Start MQTT Panel\n  mqttpanel_begin(&client, mq_receiver, \n           mqtt_server, mqtt_port, mqtt_topic_head,\n           BTN_PORTAL_SEC, BTN_RESET_SEC,\n           TRIGGER_PIN, LED_PIN,\n           CHECK_WIFI_SEC);\n\n  Serial.println(\"[Main] Configured:\");\n  Serial.printf(\" - Server: %s\\n\", mqtt_server);\n  Serial.printf(\" - Port:   %s\\n\", mqtt_port);\n  Serial.printf(\" - Topic:  %s\\n\", mqtt_topic_head);\n\n  // 3. Subscriptions (Generated)\n",
      "setup_mid": "",
      "setup_end": "}\n",
      "loop_start": "\nvoid loop() {\n  mqttpanel_loop();\n\n  // Sensor/Status Publishing (Generated)\n",
      "loop_end": "  \n  delay(500); // Reduce Load\n}\n",
      "receiver_head": "\nvoid mq_receiver(String topic, String msg) {\n  Serial.println(\"[RX] \" + topic + \" : \" + msg);\n",
      "receiver_tail": "}\n"
   },
   "components": {
      "BUTTON_CTRL": {
         "type": "switch",
         "index_key": "sw",
         "var_decl": "bool btn_{{INDEX}} = false; // {{LABEL}} (Button: SUB Only)",
         "setup_sub": "  mqttpanel_sub(String(mqtt_topic_head) + \"{{REL_TOPIC_SET}}\");",
         "loop_logic": "",
         "receiver_logic": "  if (topic == String(mqtt_topic_head) + \"{{REL_TOPIC_SET}}\") {\n    btn_{{INDEX}} = (msg == \"1\");\n    Serial.println(\"Button {{INDEX}} Pressed: \" + String(btn_{{INDEX}}));\n    // TODO: Action\n  }"
      },
      "SWITCH_CTRL": {
         "type": "switch",
         "index_key": "sw",
         "var_decl": "bool sw_{{INDEX}} = false; // {{LABEL}} (Switch: SUB+PUB)",
         "setup_sub": "  mqttpanel_sub(String(mqtt_topic_head) + \"{{REL_TOPIC_SET}}\");",
         "loop_logic": "  // Example Pub\n  if (Serial.readString() == \"{{TYPE_KEY}}{{INDEX}}\") {\n    mqttpanel_pub(String(mqtt_topic_head) + \"{{REL_TOPIC_VAL}}\", sw_{{INDEX}}?\"1\":\"0\");\n  }",
         "receiver_logic": "  if (topic == String(mqtt_topic_head) + \"{{REL_TOPIC_SET}}\") {\n    sw_{{INDEX}} = (msg == \"1\");\n    Serial.println(\"Set Switch {{INDEX}} to \" + String(sw_{{INDEX}}));\n    // TODO: digitalWrite(PIN_{{INDEX}}, sw_{{INDEX}});\n    // mqttpanel_pub(String(mqtt_topic_head) + \"{{REL_TOPIC_VAL}}\", sw_{{INDEX}}?\"1\":\"0\"); // Ack\n  }"
      },
      "DIMMER_CTRL": {
         "type": "dimmer",
         "index_key": "dim",
         "var_decl": "int dim_{{INDEX}} = 0; // {{LABEL}} (Slider: SUB+PUB)",
         "setup_sub": "  mqttpanel_sub(String(mqtt_topic_head) + \"{{REL_TOPIC_SET}}\");",
         "loop_logic": "  // Example Pub\n  if (Serial.readString() == \"{{TYPE_KEY}}{{INDEX}}\") {\n    mqttpanel_pub(String(mqtt_topic_head) + \"{{REL_TOPIC_VAL}}\", String(dim_{{INDEX}}));\n  }",
         "receiver_logic": "  if (topic == String(mqtt_topic_head) + \"{{REL_TOPIC_SET}}\") {\n    dim_{{INDEX}} = msg.toInt();\n    Serial.println(\"Set Dimmer {{INDEX}} to \" + String(dim_{{INDEX}}));\n    // TODO: analogWrite(PIN_{{INDEX}}, dim_{{INDEX}});\n  }"
      },
      "TEXT_DISP": {
         "type": "text",
         "index_key": "txt",
         "var_decl": "String txt_{{INDEX}} = \"\"; // {{LABEL}} (Display: PUB Only)",
         "setup_sub": "",
         "loop_logic": "  // Example Pub\n  if (Serial.readString() == \"{{TYPE_KEY}}{{INDEX}}\") {\n    mqttpanel_pub(String(mqtt_topic_head) + \"{{REL_TOPIC_VAL}}\", \"Hello\");\n  }",
         "receiver_logic": ""
      },
      "LED_DISP": {
         "type": "text",
         "index_key": "led",
         "var_decl": "bool led_{{INDEX}} = false; // {{LABEL}} (LED: PUB Only)",
         "setup_sub": "",
         "loop_logic": "  // Example Pub\n  if (Serial.readString() == \"{{TYPE_KEY}}{{INDEX}}\") {\n    mqttpanel_pub(String(mqtt_topic_head) + \"{{REL_TOPIC_VAL}}\", led_{{INDEX}}?\"1\":\"0\");\n  }",
         "receiver_logic": ""
      },
      "NUMBER_VAL": {
         "type": "number",
         "index_key": "num",
         "var_decl": "float num_{{INDEX}} = 0.0; // {{LABEL}} (Sensor: PUB Only)",
         "setup_sub": "",
         "loop_logic": "  static unsigned long last_num_{{INDEX}} = 0;\n  if (millis() - last_num_{{INDEX}} > 5000) {\n    last_num_{{INDEX}} = millis();\n    // num_{{INDEX}} = random(200, 300) / 10.0; // Mock Data\n    mqttpanel_pub(String(mqtt_topic_head) + \"{{REL_TOPIC_VAL}}\", String(num_{{INDEX}}));\n  }"
      },
      "SELECTOR_CTRL": {
         "type": "selector",
         "index_key": "sel",
         "var_decl": "String sel_{{INDEX}} = \"\"; // {{LABEL}} (Selector: SUB+PUB)",
         "setup_sub": "  mqttpanel_sub(String(mqtt_topic_head) + \"{{REL_TOPIC_SET}}\");",
         "loop_logic": "  // Example Pub\n  if (Serial.readString() == \"{{TYPE_KEY}}{{INDEX}}\") {\n    mqttpanel_pub(String(mqtt_topic_head) + \"{{REL_TOPIC_VAL}}\", sel_{{INDEX}});\n  }",
         "receiver_logic": "  if (topic == String(mqtt_topic_head) + \"{{REL_TOPIC_SET}}\") {\n    sel_{{INDEX}} = msg;\n    Serial.println(\"Set Selector {{INDEX}} to \" + sel_{{INDEX}});\n    // TODO: if (sel_{{INDEX}} == \"val1\") { ... }\n  }"
      },
      "JOYSTICK_CTRL": {
         "type": "joystick",
         "index_key": "joy",
         "var_decl": "int joy_{{INDEX}}_x = 0; int joy_{{INDEX}}_y = 0; // {{LABEL}} (Joystick: SUB+PUB)",
         "setup_sub": "  mqttpanel_sub(String(mqtt_topic_head) + \"{{REL_TOPIC_SET}}\");",
         "loop_logic": "  // Example Pub (Continuous Send requires JSON string)\n  // mqttpanel_pub(String(mqtt_topic_head) + \"{{REL_TOPIC_VAL}}\", \"{\\\"x\\\":0, \\\"y\\\":0}\");",
         "receiver_logic": "  if (topic == String(mqtt_topic_head) + \"{{REL_TOPIC_SET}}\") {\n    Serial.println(\"Joystick {{INDEX}} Data: \" + msg);\n    // TODO: Use a JSON library (like ArduinoJson) to parse msg\n    // Or manual parsing: if (msg.indexOf(\\\"up\\\") != -1) { ... }\n  }"
      }
   },
   "mappings": {
      "BUTTON": "BUTTON_CTRL",
      "SWITCH": "SWITCH_CTRL",
      "SLIDER": "DIMMER_CTRL",
      "SELECTOR": "SELECTOR_CTRL",
      "JOYSTICK": "JOYSTICK_CTRL",
      "TEXT": "TEXT_DISP",
      "LED": "LED_DISP",
      "THERMOMETER": "NUMBER_VAL"
   }
}